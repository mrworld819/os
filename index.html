<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Muzaffar OS</title>
<style>
  body { margin:0; font-family:sans-serif; background: linear-gradient(135deg,#74ebd5,#ACB6E5); overflow:hidden; }
  #desktop { position:relative; width:100%; height:100vh; overflow:hidden; }
  .icon { position:absolute; width:80px; text-align:center; cursor:pointer; color:#fff; font-size:12px; transition: transform 0.2s; }
  .icon:hover { transform: scale(1.1); }
  .icon img { width:60px; height:60px; margin-bottom:5px; }
  .app { display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:#f0f0f0; z-index:1000; overflow:auto; transition:all 0.3s ease; }
  .app-header { background:#1c92d2; color:#fff; padding:10px; font-size:18px; position:sticky; top:0; display:flex; justify-content:space-between; align-items:center; }
  .close-btn { background:#fff; color:#1c92d2; border:none; font-size:18px; width:30px; height:30px; border-radius:50%; cursor:pointer; }
  .app-body { padding:10px; }
  input[type=text], input[type=url], input[type=number], input[type=password] { padding:8px; width:100%; margin:5px 0; border:1px solid #ccc; border-radius:4px; }
  button { padding:8px 15px; margin:3px; cursor:pointer; border:none; border-radius:5px; background:#1c92d2; color:#fff; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
  .setting-section { background:#fff; margin:10px 0; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  .setting-title { font-weight:bold; margin-bottom:10px; color:#1c92d2; }
  .setting-item { margin:10px 0; }
  .url-input-group { display:flex; gap:10px; margin:10px 0; }
  .url-input-group input { flex:1; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è iframe */
  .app-iframe { width:100%; height:90vh; border:none; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π */
  .create-app-form { background:#f8f9fa; padding:15px; border-radius:8px; margin:10px 0; }
  .form-group { margin:10px 0; }
  .form-group label { display:block; margin-bottom:5px; font-weight:bold; }
  .app-list { margin-top:20px; }
  .app-item { display:flex; justify-content:space-between; align-items:center; padding:10px; background:#fff; margin:5px 0; border-radius:5px; border:1px solid #ddd; }
  .delete-btn { background:#ff6b6b; color:white; border:none; padding:5px 10px; border-radius:3px; cursor:pointer; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è Muzaffar Pay */
  .pay-card { background:linear-gradient(135deg,#1c92d2,#f2fcfe); color:#fff; padding:20px; border-radius:15px; box-shadow:0 4px 10px rgba(0,0,0,0.3); width:90%; margin:0 auto 20px; }
  .admin-badge { background:gold; color:black; padding:3px 8px; border-radius:10px; font-size:12px; font-weight:bold; margin-left:10px; }
  .code-status { font-size:12px; margin-top:5px; }
  .used { color:#ff6b6b; }
  .active { color:#4CAF50; }
  .transaction-item { 
    padding:10px; 
    margin:5px 0; 
    background:#f9f9f9; 
    border-radius:5px; 
    border-left:4px solid #1c92d2; 
  }
  .transaction-received { border-left-color: #4CAF50; }
  .transaction-sent { border-left-color: #ff9800; }
  .login-form { background:#fff; padding:15px; border-radius:8px; margin:10px 0; }
  .security-note { background:#fff3cd; border:1px solid #ffeaa7; padding:10px; border-radius:5px; margin:10px 0; font-size:12px; }
</style>
</head>
<body>
<div id="desktop">
  <!-- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>

<!-- ------------------------ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ------------------------ -->
<div id="settingsApp" class="app">
  <div class="app-header">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ <button class="close-btn" onclick="closeApp('settingsApp')">√ó</button></div>
  <div class="app-body">
    
    <div class="setting-section">
      <div class="setting-title">üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏</div>
      
      <div class="create-app-form">
        <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</label>
          <input type="text" id="appName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: YouTube">
        </div>
        <div class="form-group">
          <label>URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</label>
          <input type="url" id="appUrl" placeholder="https://example.com">
        </div>
        <div class="form-group">
          <label>–ò–∫–æ–Ω–∫–∞ (URL):</label>
          <input type="url" id="appIcon" placeholder="https://img.icons8.com/fluency/96/name.png">
          <small>–ú–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∏–∫–æ–Ω–∫–∏ –Ω–∞ <a href="https://icons8.com" target="_blank">icons8.com</a></small>
        </div>
        <button onclick="createNewApp()">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
      </div>
      
      <div class="app-list">
        <h3>–ú–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
        <div id="appsList">
          <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
      </div>
    </div>

    <div class="setting-section">
      <div class="setting-title">üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
      <div class="setting-item">
        <label>–û–±–æ–∏:</label>
        <select id="wallpaperSelect">
          <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç</option>
          <option value="blue">–°–∏–Ω–∏–π</option>
          <option value="nature">–ü—Ä–∏—Ä–æ–¥–∞</option>
          <option value="space">–ö–æ—Å–º–æ—Å</option>
          <option value="dark">–¢–µ–º–Ω—ã–π</option>
        </select>
      </div>
    </div>
    
    <div class="setting-section">
      <div class="setting-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
      <button onclick="addSampleApps()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</button>
      <button onclick="clearAllApps()" style="background:#ff6b6b;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</button>
    </div>
  </div>
</div>

<!-- ------------------------ Muzaffar Pay App ------------------------ -->
<div id="payApp" class="app">
  <div class="app-header">
    üí≥ Muzaffar Pay
    <button class="close-btn" onclick="closeApp('payApp')">√ó</button>
  </div>
  <div class="app-body" style="text-align:center;">
    
    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
    <div id="loginSection" class="login-form">
      <h3>–í—Ö–æ–¥ –≤ Muzaffar Pay</h3>
      <input type="text" id="username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
      <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
      <button onclick="login()">–í–æ–π—Ç–∏</button>
      <button onclick="register()" style="background:#4CAF50;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      
      <div class="security-note">
        üîí <strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> –ü–∞—Ä–æ–ª–∏ –∑–∞—â–∏—â–µ–Ω—ã –∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∫–æ–¥–µ
      </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div id="mainPaySection" style="display:none;">
      <div class="pay-card">
        <h2>Muzaffar Pay <span id="adminBadge" class="admin-badge" style="display:none;">ADMIN</span></h2>
        <p id="balance" style="font-size:24px;font-weight:bold;">0 ‚ÇÆ</p>
        <p id="userInfo" style="font-size:14px;"></p>
      </div>

      <div>
        <input id="amount" type="number" placeholder="–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞" min="1">
        <br>
        <button onclick="generateCode()">–°–æ–∑–¥–∞—Ç—å –∫–æ–¥ –æ–ø–ª–∞—Ç—ã</button>
        <button onclick="applyCode()">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥</button>
        <button id="adminBtn" onclick="toggleAdminPanel()" style="background:#ff9800; display:none;">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        <button onclick="logout()" style="background:#666;">–í—ã–π—Ç–∏</button>
      </div>

      <div id="transferCode" style="margin-top:15px; padding:10px; background:#f8f9fa; border-radius:5px;"></div>

      <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
      <div id="adminPanel" style="display:none; margin-top:20px; padding:15px; background:#fff; border-radius:8px;">
        <h3>üîß –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
        <button onclick="addFundsToAll()" style="background:#4CAF50;">‚ûï –ù–∞—á–∏—Å–ª–∏—Ç—å –≤—Å–µ–º –ø–æ 1000 ‚ÇÆ</button>
        <button onclick="resetAllBalances()" style="background:#ff6b6b;">üîÑ –û–±–Ω—É–ª–∏—Ç—å –≤—Å–µ —Å—á–µ—Ç–∞</button>
        <button onclick="viewAllUsers()" style="background:#9c27b0;">üë• –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
        
        <div id="allUsersList" style="margin-top:15px; max-height:200px; overflow-y:auto;"></div>
      </div>

      <hr style="margin:20px 0;border:none;height:1px;background:#ddd;">

      <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
      <ul id="history" style="list-style:none;padding:0;max-height:200px;overflow-y:auto;"></ul>
    </div>
  </div>
</div>

<script>
  // ------------------------ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ------------------------
  let userApps = JSON.parse(localStorage.getItem('muzaffar_user_apps') || '[]');
  let nextPosition = { x: 40, y: 40 };
  const GRID_SIZE = 100;
  
  // ------------------------ Muzaffar Pay —É–ª—É—á—à–µ–Ω–Ω—ã–π ------------------------
  let currentUser = null;
  let users = JSON.parse(localStorage.getItem('muzaffar_pay_users') || '[]');
  let paymentCodes = JSON.parse(localStorage.getItem('muzaffar_payment_codes') || '[]');
  
  // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
  function initializeBankSystem() {
    // –°–æ–∑–¥–∞–µ–º —Ö–µ—à–∏ –¥–ª—è –ø–∞—Ä–æ–ª–µ–π –≤–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
    const adminPasswordHash = generateHash('bank_admin_secure_2024');
    const userPasswordHash = generateHash('user_default_pass');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    if (!users.find(u => u.username === 'BankAdmin')) {
      users.push({
        username: 'BankAdmin',
        passwordHash: adminPasswordHash,
        balance: 9999999,
        isAdmin: true,
        transactions: ['–°–∏—Å—Ç–µ–º–∞: –ê–¥–º–∏–Ω –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω'],
        createdAt: new Date().toISOString()
      });
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (!users.find(u => u.username === 'demo')) {
      users.push({
        username: 'demo',
        passwordHash: userPasswordHash,
        balance: 1000,
        isAdmin: false,
        transactions: ['–°–∏—Å—Ç–µ–º–∞: –î–µ–º–æ –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω'],
        createdAt: new Date().toISOString()
      });
    }
    
    localStorage.setItem('muzaffar_pay_users', JSON.stringify(users));
  }

  // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ bcrypt)
  function generateHash(password) {
    let hash = 0;
    for (let i = 0; i < password.length; i++) {
      const char = password.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash;
    }
    return hash.toString();
  }

  function verifyPassword(inputPassword, storedHash) {
    return generateHash(inputPassword) === storedHash;
  }

  // ------------------------ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ------------------------
  document.addEventListener('DOMContentLoaded', function() {
    initializeBankSystem();
    loadUserApps();
    updateAppsList();
    checkAutoLogin();
  });

  // ------------------------ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ ------------------------
  function loadUserApps() {
    const desktop = document.getElementById('desktop');
    
    // –û—á–∏—â–∞–µ–º –¥–µ—Å–∫—Ç–æ–ø (–∫—Ä–æ–º–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ Muzaffar Pay)
    const existingIcons = desktop.querySelectorAll('.icon:not(#settingsIcon):not(#payIcon)');
    existingIcons.forEach(icon => icon.remove());
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    userApps.forEach(app => {
      createAppIcon(app);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ Muzaffar Pay)
    createFixedApps();
  }

  function createAppIcon(app) {
    const desktop = document.getElementById('desktop');
    const icon = document.createElement('div');
    icon.className = 'icon';
    icon.style.left = app.position.x + 'px';
    icon.style.top = app.position.y + 'px';
    icon.setAttribute('data-app-id', app.id);
    
    icon.innerHTML = `
      <img src="${app.icon}" alt="${app.name}">
      <div>${app.name}</div>
    `;
    
    icon.onclick = () => openCustomApp(app);
    desktop.appendChild(icon);
    
    // –°–æ–∑–¥–∞–µ–º iframe –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    createAppIframe(app);
  }

  function createAppIframe(app) {
    const iframe = document.createElement('iframe');
    iframe.id = `appFrame_${app.id}`;
    iframe.className = 'app-iframe';
    iframe.src = app.url;
    
    const appContainer = document.createElement('div');
    appContainer.id = `app_${app.id}`;
    appContainer.className = 'app';
    appContainer.innerHTML = `
      <div class="app-header">
        ${app.name}
        <button class="close-btn" onclick="closeApp('app_${app.id}')">√ó</button>
      </div>
      <div class="app-body"></div>
    `;
    
    appContainer.querySelector('.app-body').appendChild(iframe);
    document.body.appendChild(appContainer);
  }

  function createFixedApps() {
    const desktop = document.getElementById('desktop');
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    const settingsIcon = document.createElement('div');
    settingsIcon.className = 'icon';
    settingsIcon.style.left = '40px';
    settingsIcon.style.top = '40px';
    settingsIcon.innerHTML = `
      <img src="https://img.icons8.com/fluency/96/settings.png" alt="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
      <div>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    `;
    settingsIcon.onclick = () => openApp('settingsApp');
    desktop.appendChild(settingsIcon);
    
    // Muzaffar Pay
    const payIcon = document.createElement('div');
    payIcon.className = 'icon';
    payIcon.style.left = '140px';
    payIcon.style.top = '40px';
    payIcon.innerHTML = `
      <img src="https://img.icons8.com/fluency/96/bank-cards.png" alt="Muzaffar Pay">
      <div>Muzaffar Pay</div>
    `;
    payIcon.onclick = () => openApp('payApp');
    desktop.appendChild(payIcon);
  }

  function createNewApp() {
    const name = document.getElementById('appName').value.trim();
    const url = document.getElementById('appUrl').value.trim();
    const icon = document.getElementById('appIcon').value.trim() || 'https://img.icons8.com/fluency/96/application.png';
    
    if (!name || !url) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
      return;
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
    const position = getNextPosition();
    
    const newApp = {
      id: Date.now().toString(),
      name: name,
      url: url,
      icon: icon,
      position: position
    };
    
    userApps.push(newApp);
    saveUserApps();
    createAppIcon(newApp);
    updateAppsList();
    
    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
    document.getElementById('appName').value = '';
    document.getElementById('appUrl').value = '';
    document.getElementById('appIcon').value = '';
    
    alert(`–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "${name}" —Å–æ–∑–¥–∞–Ω–æ!`);
  }

  function getNextPosition() {
    const positions = userApps.map(app => app.position);
    let x = 40, y = 140;
    let foundPosition = false;
    
    while (!foundPosition) {
      const positionExists = positions.some(pos => pos.x === x && pos.y === y);
      if (!positionExists) {
        foundPosition = true;
      } else {
        x += GRID_SIZE;
        if (x > 500) {
          x = 40;
          y += GRID_SIZE;
        }
      }
    }
    
    return { x: x, y: y };
  }

  function deleteApp(appId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?')) {
      userApps = userApps.filter(app => app.id !== appId);
      saveUserApps();
      
      // –£–¥–∞–ª—è–µ–º –∏–∫–æ–Ω–∫—É
      const icon = document.querySelector(`[data-app-id="${appId}"]`);
      if (icon) icon.remove();
      
      // –£–¥–∞–ª—è–µ–º iframe
      const appContainer = document.getElementById(`app_${appId}`);
      if (appContainer) appContainer.remove();
      
      updateAppsList();
    }
  }

  function updateAppsList() {
    const appsList = document.getElementById('appsList');
    appsList.innerHTML = '';
    
    if (userApps.length === 0) {
      appsList.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</p>';
      return;
    }
    
    userApps.forEach(app => {
      const appItem = document.createElement('div');
      appItem.className = 'app-item';
      appItem.innerHTML = `
        <div>
          <strong>${app.name}</strong><br>
          <small>${app.url}</small>
        </div>
        <button class="delete-btn" onclick="deleteApp('${app.id}')">–£–¥–∞–ª–∏—Ç—å</button>
      `;
      appsList.appendChild(appItem);
    });
  }

  function saveUserApps() {
    localStorage.setItem('muzaffar_user_apps', JSON.stringify(userApps));
  }

  // ------------------------ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞–º–∏ ------------------------
  function openApp(id) {
    document.getElementById(id).style.display = 'block';
  }

  function openCustomApp(app) {
    document.getElementById(`app_${app.id}`).style.display = 'block';
  }

  function closeApp(id) {
    document.getElementById(id).style.display = 'none';
  }

  // ------------------------ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ------------------------
  function addSampleApps() {
    const sampleApps = [
      {
        name: 'YouTube',
        url: 'https://www.youtube.com',
        icon: 'https://img.icons8.com/color/96/youtube-play.png'
      },
      {
        name: 'Google',
        url: 'https://www.google.com',
        icon: 'https://img.icons8.com/color/96/google-logo.png'
      },
      {
        name: 'Gmail',
        url: 'https://mail.google.com',
        icon: 'https://img.icons8.com/color/96/gmail.png'
      }
    ];
    
    sampleApps.forEach(appData => {
      const position = getNextPosition();
      const newApp = {
        id: Date.now().toString() + Math.random(),
        name: appData.name,
        url: appData.url,
        icon: appData.icon,
        position: position
      };
      userApps.push(newApp);
      createAppIcon(newApp);
    });
    
    saveUserApps();
    updateAppsList();
    alert('–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω—ã!');
  }

  function clearAllApps() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è?')) {
      userApps = [];
      saveUserApps();
      loadUserApps();
      updateAppsList();
      alert('–í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã!');
    }
  }

  // ------------------------ Muzaffar Pay —É–ª—É—á—à–µ–Ω–Ω—ã–π ------------------------
  function checkAutoLogin() {
    const savedUser = localStorage.getItem('muzaffar_current_user');
    if (savedUser) {
      const userData = JSON.parse(savedUser);
      loginUser(userData.username, userData.password, true);
    }
  }

  function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    
    if (!username || !password) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å');
      return;
    }
    
    loginUser(username, password, false);
  }

  function loginUser(username, password, isAutoLogin) {
    const user = users.find(u => u.username === username);
    
    if (user && verifyPassword(password, user.passwordHash)) {
      currentUser = user;
      
      if (!isAutoLogin) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã)
        localStorage.setItem('muzaffar_current_user', JSON.stringify({
          username: user.username,
          password: password // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ
        }));
      }
      
      showPayInterface();
      updatePayUI();
      
      if (!isAutoLogin) {
        alert(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.username}!`);
      }
    } else {
      if (!isAutoLogin) {
        alert('–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
      }
    }
  }

  function register() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    
    if (!username || !password) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å');
      return;
    }
    
    if (users.find(u => u.username === username)) {
      alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
      return;
    }
    
    if (password.length < 4) {
      alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞');
      return;
    }
    
    const newUser = {
      username: username,
      passwordHash: generateHash(password),
      balance: 0,
      isAdmin: false,
      transactions: ['–°–∏—Å—Ç–µ–º–∞: –ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω'],
      createdAt: new Date().toISOString()
    };
    
    users.push(newUser);
    localStorage.setItem('muzaffar_pay_users', JSON.stringify(users));
    
    alert('–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.');
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
  }

  function logout() {
    currentUser = null;
    localStorage.removeItem('muzaffar_current_user');
    document.getElementById('loginSection').style.display = 'block';
    document.getElementById('mainPaySection').style.display = 'none';
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
    document.getElementById('adminPanel').style.display = 'none';
  }

  function showPayInterface() {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('mainPaySection').style.display = 'block';
    
    if (currentUser.isAdmin) {
      document.getElementById('adminBadge').style.display = 'inline';
      document.getElementById('adminBtn').style.display = 'inline-block';
    } else {
      document.getElementById('adminBadge').style.display = 'none';
      document.getElementById('adminBtn').style.display = 'none';
    }
  }

  function updatePayUI() {
    if (!currentUser) return;
    
    document.getElementById('balance').textContent = formatBalance(currentUser.balance) + " ‚ÇÆ";
    document.getElementById('userInfo').textContent = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser.username}`;
    
    const list = document.getElementById('history');
    list.innerHTML = currentUser.transactions.map((t, index) => 
      `<li class="transaction-item ${t.includes('–ü–æ–ª—É—á–µ–Ω–æ') ? 'transaction-received' : t.includes('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ') ? 'transaction-sent' : ''}">
        ${t} ${index === 0 ? 'üÜï' : ''}
      </li>`
    ).reverse().join('');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userIndex = users.findIndex(u => u.username === currentUser.username);
    if (userIndex !== -1) {
      users[userIndex] = currentUser;
      localStorage.setItem('muzaffar_pay_users', JSON.stringify(users));
    }
  }

  function formatBalance(amount) {
    return amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
  }

  function generateCode() {
    if (!currentUser) return;
    
    const amount = parseFloat(document.getElementById('amount').value);
    
    if (!amount || amount <= 0) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
      return;
    }
    
    if (!currentUser.isAdmin && amount > currentUser.balance) {
      alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
      return;
    }
    
    // –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–¥—ã –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
    if (!currentUser.isAdmin) {
      currentUser.balance -= amount;
    }
    
    const code = "BANK-" + Math.random().toString(36).substring(2, 8).toUpperCase() + "-" + Math.random().toString(36).substring(2, 6).toUpperCase();
    const codeData = {
      code: code,
      amount: amount,
      createdBy: currentUser.username,
      createdAt: new Date().toISOString(),
      used: false,
      usedBy: null,
      usedAt: null
    };
    
    paymentCodes.push(codeData);
    localStorage.setItem('muzaffar_payment_codes', JSON.stringify(paymentCodes));
    
    document.getElementById('transferCode').innerHTML = `
      <strong>üí∞ –ö–æ–¥ –æ–ø–ª–∞—Ç—ã: ${code}</strong><br>
      <span class="code-status active">üíµ –°—É–º–º–∞: ${amount} ‚ÇÆ</span><br>
      <span class="code-status active">‚è∞ –°–æ–∑–¥–∞–Ω: ${new Date().toLocaleTimeString()}</span><br>
      <small>‚ö†Ô∏è –ö–æ–¥ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑</small>
    `;
    
    const transactionMessage = currentUser.isAdmin ? 
      `–°–æ–∑–¥–∞–Ω –∫–æ–¥ –æ–ø–ª–∞—Ç—ã ${amount} ‚ÇÆ (${code}) [–ê–î–ú–ò–ù]` :
      `–°–æ–∑–¥–∞–Ω –∫–æ–¥ –æ–ø–ª–∞—Ç—ã ${amount} ‚ÇÆ (${code})`;
    
    currentUser.transactions.unshift(transactionMessage);
    updatePayUI();
  }

  function applyCode() {
    if (!currentUser) return;
    
    const code = prompt("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –æ–ø–ª–∞—Ç—ã:");
    if (!code) return;
    
    const codeData = paymentCodes.find(c => c.code === code);
    
    if (!codeData) {
      alert("–ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω");
      return;
    }
    
    if (codeData.used) {
      alert("–ö–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω");
      return;
    }
    
    if (codeData.createdBy === currentUser.username) {
      alert("–ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥");
      return;
    }
    
    // –ü–æ–º–µ—á–∞–µ–º –∫–æ–¥ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π
    codeData.used = true;
    codeData.usedBy = currentUser.username;
    codeData.usedAt = new Date().toISOString();
    localStorage.setItem('muzaffar_payment_codes', JSON.stringify(paymentCodes));
    
    // –ó–∞—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥—Å—Ç–≤–∞
    currentUser.balance += codeData.amount;
    currentUser.transactions.unshift(`–ü–æ–ª—É—á–µ–Ω–æ ${codeData.amount} ‚ÇÆ (–∫–æ–¥: ${code})`);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    updatePayUI();
    document.getElementById('transferCode').innerHTML = `
      <span style="color:#4CAF50;">‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –ø–æ–ª—É—á–µ–Ω: ${codeData.amount} ‚ÇÆ</span><br>
      <small>–û—Ç: ${codeData.createdBy}</small>
    `;
    
    alert(`–£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ ${codeData.amount} ‚ÇÆ!`);
  }

  function toggleAdminPanel() {
    const panel = document.getElementById('adminPanel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
  }

  function addFundsToAll() {
    if (!currentUser || !currentUser.isAdmin) return;
    
    users.forEach(user => {
      if (!user.isAdmin) {
        user.balance += 1000;
        user.transactions.unshift(`–ê–¥–º–∏–Ω: –ù–∞—á–∏—Å–ª–µ–Ω–æ 1000 ‚ÇÆ`);
      }
    });
    
    localStorage.setItem('muzaffar_pay_users', JSON.stringify(users));
    alert('–í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ –ø–æ 1000 ‚ÇÆ!');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –æ–Ω –Ω–µ –∞–¥–º–∏–Ω
    if (!currentUser.isAdmin) {
      const updatedUser = users.find(u => u.username === currentUser.username);
      if (updatedUser) {
        currentUser = updatedUser;
        updatePayUI();
      }
    }
  }

  function resetAllBalances() {
    if (!currentUser || !currentUser.isAdmin) return;
    
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω—É–ª–∏—Ç—å –≤—Å–µ —Å—á–µ—Ç–∞ (–∫—Ä–æ–º–µ –∞–¥–º–∏–Ω–∞)?')) {
      users.forEach(user => {
        if (!user.isAdmin) {
          user.balance = 0;
          user.transactions.unshift(`–ê–¥–º–∏–Ω: –°—á–µ—Ç –æ–±–Ω—É–ª–µ–Ω`);
        }
      });
      
      localStorage.setItem('muzaffar_pay_users', JSON.stringify(users));
      alert('–í—Å–µ —Å—á–µ—Ç–∞ –æ–±–Ω—É–ª–µ–Ω—ã!');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –æ–Ω –Ω–µ –∞–¥–º–∏–Ω
      if (!currentUser.isAdmin) {
        const updatedUser = users.find(u => u.username === currentUser.username);
        if (updatedUser) {
          currentUser = updatedUser;
          updatePayUI();
        }
      }
    }
  }

  function viewAllUsers() {
    if (!currentUser || !currentUser.isAdmin) return;
    
    const usersList = document.getElementById('allUsersList');
    usersList.innerHTML = users.map(user => `
      <div style="padding:8px; margin:5px 0; background:#f5f5f5; border-radius:5px;">
        <strong>${user.username}</strong> ${user.isAdmin ? 'üëë –ê–î–ú–ò–ù' : ''}<br>
        –ë–∞–ª–∞–Ω—Å: ${user.balance} ‚ÇÆ<br>
        <small>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${user.transactions.length}</small><br>
        <small>–°–æ–∑–¥–∞–Ω: ${new Date(user.createdAt).toLocaleDateString()}</small>
      </div>
    `).join('');
  }

  // ------------------------ –û–±–æ–∏ ------------------------
  document.getElementById('wallpaperSelect').addEventListener('change', function() {
    const wallpaper = this.value;
    let gradient = 'linear-gradient(135deg,#74ebd5,#ACB6E5)';
    
    if (wallpaper === 'blue') {
      gradient = 'linear-gradient(135deg,#1c92d2,#f2fcfe)';
    } else if (wallpaper === 'nature') {
      gradient = 'linear-gradient(135deg,#56ab2f,#a8e063)';
    } else if (wallpaper === 'space') {
      gradient = 'linear-gradient(135deg,#0f2027,#203a43,#2c5364)';
    } else if (wallpaper === 'dark') {
      gradient = 'linear-gradient(135deg,#2c3e50,#34495e)';
    }
    
    document.body.style.background = gradient;
    localStorage.setItem('muzaffar_wallpaper', wallpaper);
  });
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ–±–æ–∏
  const savedWallpaper = localStorage.getItem('muzaffar_wallpaper') || 'gradient';
  document.getElementById('wallpaperSelect').value = savedWallpaper;
  document.getElementById('wallpaperSelect').dispatchEvent(new Event('change'));
</script>
</body>
</html>
